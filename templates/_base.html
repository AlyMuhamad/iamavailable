<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      type="image/png"
      href="{% static 'images/favicon.png' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'styles/styles.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'styles/scss/custom.css' %}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    {% block title %}
    <title>IAmAvailable</title>
    {% endblock %}
  </head>
  <body>
    <div class="shadow-sm mb-5 bg-white">
      <div class="navbar container ps-3 pe-3">
        <div class="d-flex align-items-center">
          <a
            href=" {% url 'home' %}"
            class="text-decoration-none fs-4 fw-bold text-dark"
            >IAmAvailable</a
          >
          {% if request.user.is_authenticated %}
          <a
            href="{% url 'create_company' %}"
            class="text-decoration-none text-dark employer-link"
            >Employers | Post job</a
          >
          {% endif %}
        </div>
        <div class="d-flex gap-3 align-items-center">
          {% if request.user.is_authenticated %}
          <div class="d-flex align-items-center gap-4 profile-options">
            <a href="{% url 'notification' %}"
              ><div class="position-relative">
                <i class="fa-solid fa-bell text-black-50 fs-5"></i>
                {% if notificationCount != 0 %}
                <div
                  class="count-box d-flex justify-content-center align-items-center position-absolute top-0 start-100 translate-middle w-75 h-75 bg-danger rounded-circle"
                >
                  <p
                    class="text-decoration-none text-white p-0 m-0"
                    style="font-size: 0.8rem"
                  >
                    {{notificationCount}}
                  </p>
                </div>
                {% endif %}
              </div>
            </a>
            <a href="{% url 'applications' %}"
              ><i class="fa-solid fa-clock-rotate-left text-black-50 fs-5"></i
            ></a>
            <a href="{% url 'saved' %}"
              ><i class="fa-solid fa-bookmark text-black-50 fs-5"></i
            ></a>
            <a
              href=" {% url 'account' %}"
              class="text-decoration-none p-2 rounded"
            >
              <img
                src="{% static 'images/profiles/default-profile.jpg' %}"
                class="rounded-circle align-self-center profile-picture"
                width="50"
                height="50"
              />
            </a>
          </div>
          {% else %}
          <a
            href="{% url 'login' %}"
            class="text-decoration-none text-white bg-dark p-2 ps-4 pe-4 rounded"
            >Login</a
          >
          {% endif %}
        </div>
      </div>
    </div>

    <div class="container">
      {% if messages %}
      <ul
        class="messages list-unstyled border border-light p-2 rounded bg-light.bg-gradient text-center"
      >
        {% for message in messages %}
        <li {% if message.tags %} class="{{message.tags}}" {% endif %}>
          {{message}}
        </li>
        {% endfor %}
      </ul>
      {% endif %}
    </div>
    {% block content %} {% endblock %}
    <footer class="footer">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-4">
            <div class="footer-brand">IAmAvailable</div>
            <p class="footer-text">
              The best job board for developers and all technical specialists
              all over the world
            </p>
            <div class="social-links">
              <a href="#" class="social-link"
                ><i class="fab fa-linkedin"></i
              ></a>
              <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
              <a href="#" class="social-link"
                ><i class="fab fa-facebook"></i
              ></a>
              <a href="#" class="social-link"
                ><i class="fab fa-instagram"></i
              ></a>
            </div>
          </div>

          <div class="col-md-4 text-md-end">
            <ul class="footer-links">
              <li><a href=" {% url 'about' %}">About</a></li>
              <li><a href="{% url 'contact' %}">Contact</a></li>
              <li><a href="{% url 'terms' %}">Terms</a></li>
              <li><a href="{% url 'faq' %}">FAQ</a></li>
            </ul>
          </div>

          <form class="col-md-4">
            {% csrf_token %}
            <p class="footer-brand">Subscribe</p>
            <p class="footer-text">
              Subscribe to our newsletter and stay updated
            </p>
            <div class="position-relative">
              <input
                class="p-2 border-0 rounded w-100 email"
                placeholder="Enter your email"
              />
              <button
                class="border-0 p-2 rounded text-white bg-dark position-absolute end-0 top-50 translate-middle-y subBtn"
              >
                Subscribe
              </button>
            </div>
          </form>
        </div>

        <div class="copyright text-center">
          Â© 2025 IAmAvailable. All rights reserved.
        </div>
      </div>
    </footer>
    {% block js %} {% endblock %}
    <script>
      const subBtn = document.querySelector('.subBtn');
      const email = document.querySelector('.email');
      subBtn.addEventListener('click', e => {
        e.preventDefault();
        if (!email.value) {
          email.placeholder = 'Please enter a valid email';
          return;
        } else {
          subscribe();
        }
      });

      async function subscribe() {
        const requestOptions = {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: email.value,
          }),
        };

        try {
          const res = await fetch(`/subscribe/`, requestOptions);
          if (res.status == 400) {
            email.value = '';
            email.placeholder = 'Invalid email, Please enter a valid email';
          }
          if (res.status == 409) {
            email.value = '';
            email.placeholder =
              'This email was used before, Please enter a valid email';
          }
          if (res.status == 200) {
            email.value = '';
            email.placeholder = 'Your email was subscried to our newsletter';
          }
        } catch (err) {
          console.log(err);
        }
      }

      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + '=') {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
            }
            break;
          }
        }
        return cookieValue;
      }
    </script>
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'styles/styles.css' %}"
    />
  </body>
</html>
